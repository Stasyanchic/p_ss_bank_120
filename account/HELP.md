# Account Microservice Help

## Содержание
- [Описание модуля](#описание-модуля)
- [Функциональные возможности](#функциональные-возможности)
- [Архитектура](#архитектура)
   - [Сущности (Entities)](#сущности-entities)
   - [DTO (Data Transfer Objects)](#dto-data-transfer-objects)
   - [Репозитории (Repositories)](#репозитории-repositories)
   - [Сервисный слой (Services)](#сервисный-слой-services)
   - [Мапперы (Mappers)](#мапперы-mappers)
   - [Контроллер (Controller)](#контроллер-controller)
   - [Конфигурация](#конфигурация)
   - [AOP-слой (Audit Logging)](#aop-слой-audit-logging)
- [Основные API-сценарии](#основные-api-сценарии)
   - [Создание учетной записи](#1-создание-учетной-записи)
   - [Обновление учетной записи](#2-обновление-учетной-записи)
   - [Удаление учетной записи](#3-удаление-учетной-записи)
   - [Получение учетных записей](#4-получение-учетных-записей)
- [Технологический стек](#технологический-стек)
- [Обработка ошибок (Exception Handling)](#обработка-ошибок-exception-handling)
- [Безопасность](#безопасность)
- [Логирование и мониторинг](#логирование-и-мониторинг)
- [Развертывание](#развертывание)
- [Дополнительные требования](#дополнительные-требования)

## Описание модуля
Account Microservice предназначен для управления учетными записями и ведения истории изменений. Основной функционал включает создание, обновление, удаление, получение учетных записей и аудит изменений.

## Функциональные возможности
- REST API с CRUD-операциями.
- Логирование изменений в таблицу аудита.
- Интеграция с PostgreSQL.
- JWT-аутентификация.
- Автоматическая генерация документации (Swagger/OpenAPI).

## Архитектура
### Сущности (Entities)
- `Account` – модель учетной записи.
- `Audit` – модель записи аудита.

### DTO (Data Transfer Objects)
- `AccountDto` – передача данных учетной записи через API.
- `AuditDto` – передача информации об изменениях.

### Репозитории (Repositories)
- `AccountRepository` – управление учетными записями.
- `AuditRepository` – управление аудитом.

### Сервисный слой (Services)
- `AccountService` – интерфейс CRUD-операций.
- `AccountServiceImpl` – реализация бизнес-логики.
- `AuditService` – интерфейс аудита.
- `AuditServiceImpl` – реализация логирования изменений.

### Мапперы (Mappers)
- `AccountMapper` – преобразует сущности учетных записей в DTO и обратно.
- `AuditMapper` – преобразует сущности аудита в DTO и обратно.

### Контроллер (Controller)
- `AccountController` – REST API для работы с учетными записями.

### Конфигурация
- `SwaggerConfig` – настройка Swagger.

## AOP-слой (Audit Logging)

Логирование изменений в системе осуществляется с помощью **AOP (Aspect-Oriented Programming)**. Это позволяет автоматически фиксировать все значимые изменения без дублирования кода.

### Принципы работы:
- **Таблица `audit` заполняется автоматически** при изменении данных `Account`.
- **AOP-аспект отслеживает изменения в базе** и фиксирует их в `audit`.
- **Контроллер для аудита не нужен**, так как все изменения фиксируются на уровне сервисного слоя.
- **Все бизнес-правила и логика работы с аудиторией находятся в сервисном слое.**
- **Для соблюдения принципа единственной ответственности (SRP), бизнес-логика выносится в сервисный слой.**
- **AOP-слой отвечает только за перехват вызовов и регистрацию изменений**, а сам процесс аудита выполняется в `AuditService`.

### Компоненты AOP:
- `AuditAspect` – аспект, перехватывающий вызовы методов `create` и `update` в `UserServiceImpl`.
- **Автоматически заполняет таблицу `Audit`** при изменении данных пользователя.
- **Логирует, кто и когда внес изменения**.

### Пример работы:
При изменении учетной записи (`Account`) AOP-аспект автоматически фиксирует это в `audit`:
```java
@Aspect
@Component
public class AuditAspect {

    @AfterReturning(pointcut = "execution(* com.example.service.UserServiceImpl.create(..)) || " +
                                "execution(* com.example.service.UserServiceImpl.update(..))",
                    returning = "result")
    public void logChanges(JoinPoint joinPoint, Object result) {
        // Логика фиксации изменений в таблицу audit
    }
}
